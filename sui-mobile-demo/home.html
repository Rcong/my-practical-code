<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>sui-mobile demo</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm.min.css">
    <link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm-extend.min.css">
    <style media="screen">
        .list-block {
            margin: 0rem 0rem;
        }

        .panel-left .content-block img {
            margin: 0 30px;
            border-radius: 50%;
        }

        .panel-left .content-block .name {
            text-align: center;
            font-size: 1rem;
        }
    </style>
  </head>
  <body>
    <!-- page集合的容器，里面放多个平行的.page，其他.page作为内联页面由路由控制展示 -->
    <div class="page-group">
        <!-- 单个page ,第一个.page默认被展示-->
        <div id="page-ptr" class="page page-current">
            <!-- 标题栏 -->
            <header class="bar bar-nav">
                <a class="icon icon-me pull-left open-panel"></a>
                <h1 class="title">sui-mobile demo</h1>
            </header>

            <!-- 工具栏 -->
            <nav class="bar bar-tab">
                <a class="tab-item external active" href="#">
                    <span class="icon icon-home"></span>
                    <span class="tab-label">首页</span>
                </a>
                <a class="tab-item" href="http://m.sui.taobao.org/demos/">
                    <span class="icon icon-star"></span>
                    <span class="tab-label">跳转至Demo</span>
                </a>
                <a class="tab-item external" href="me.html">
                    <span class="icon icon-me"></span>
                    <span class="tab-label">Me</span>
                </a>
            </nav>

            <!-- 这里是页面内容区 -->
            <div id="content" class="content infinite-scroll">
              <div class="list-block media-list">
                <ul>
                </ul>
              </div>
              <!-- 加载提示符 -->
              <div class="infinite-scroll-preloader">
                  <div class="preloader"></div>
              </div>
            </div>
        </div>

        <!-- 其他的单个page内联页（如果有） -->
        <div class="page">
            ...
        </div>
    </div>

    <!-- popup, panel 等放在这里 -->
    <div class="panel-overlay"></div>
    <!-- Left Panel with Reveal effect -->
    <div class="panel panel-left panel-reveal theme-dark" id='panel-left-demo'>
        <div class="content-block">
            <img src="https://avatars2.githubusercontent.com/u/9363528?v=3&s=460" width="150" height="150">
            <div class="name">咸鱼君</div>
        </div>
        <div class="content-block-title">感兴趣的标签</div>
        <div class="list-block">
            <ul>
                <li class="item-content item-link">
                    <div class="item-media"><i class="icon icon-f7"></i></div>
                    <div class="item-inner">
                        <div class="item-title">科技</div>
                    </div>
                </li>
                <li class="item-content item-link">
                    <div class="item-media"><i class="icon icon-f7"></i></div>
                    <div class="item-inner">
                        <div class="item-title">体育</div>
                    </div>
                </li>
                <li class="item-content item-link">
                    <div class="item-media"><i class="icon icon-f7"></i></div>
                    <div class="item-inner">
                        <div class="item-title">二次元</div>
                    </div>
                </li>
                <li class="item-content item-link">
                    <div class="item-media"><i class="icon icon-f7"></i></div>
                    <div class="item-inner">
                        <div class="item-title">时政</div>
                    </div>
                </li>
                <li class="item-content item-link">
                    <div class="item-media"><i class="icon icon-f7"></i></div>
                    <div class="item-inner">
                        <div class="item-title">金融</div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    <script src="mock.js"></script>
    <!-- <script src="http://mockjs.com/dist/mock.js"></script> -->
    <script type='text/javascript' src='//g.alicdn.com/sj/lib/zepto/zepto.min.js' charset='utf-8'></script>
    <script type='text/javascript' src='//g.alicdn.com/msui/sm/0.6.2/js/sm.min.js' charset='utf-8'></script>
    <script type='text/javascript' src='//g.alicdn.com/msui/sm/0.6.2/js/sm-extend.min.js' charset='utf-8'></script>
    <script type="text/javascript">

        (function () {
            'use strict'

            Mock.mock('http://mock', {
              // 'list|10': [{
              //   'img_url': Mock.Random.dataImage('80x80', 'Mock'),
              //   'short_intro': '@cparagraph(1, 3)',
              //   'short_name': '@csentence(6,10)',
              //   'name': '@csentence(1,15)'
              // }]
              'list|2': [
                  {
                    'img_url': Mock.Random.dataImage('80x80', 'Mock'),
                    'short_intro': '@cparagraph(1, 3)',
                    'short_name': '@csentence(6,10)',
                    'name': '@csentence(1,15)'
                  },
                  {
                    'img_url': Mock.Random.dataImage('80x80', 'Mock'),
                    'short_intro': '@cparagraph(1, 3)',
                    'short_name': '@csentence(6,10)',
                    'name': '@csentence(1,15)'
                  },
                  {
                    'img_url': Mock.Random.dataImage('80x80', 'Mock'),
                    'short_intro': '@cparagraph(1, 3)',
                    'short_name': '@csentence(6,10)',
                    'name': '@csentence(1,15)'
                  },
                  {
                    'img_url': Mock.Random.dataImage('80x80', 'Mock'),
                    'short_intro': '@cparagraph(1, 3)',
                    'short_name': '@csentence(6,10)',
                    'name': '@csentence(1,15)'
                  },
                  {
                    'img_url': Mock.Random.dataImage('80x80', 'Mock'),
                    'short_intro': '@cparagraph(1, 3)',
                    'short_name': '@csentence(6,10)',
                    'name': '@csentence(1,15)'
                  }
              ]
            });

            var curPage = 1,
              perPageCount = 10;

            function addItems(selector,items) {
              var itemTpl = '<li>'+
                          '<a href="#" class="item-link item-content">'+
                            '<div class="item-media"><img src="{{img}}"></div>'+
                            '<div class="item-inner">'+
                              '<div class="item-title-row">'+
                                '<div class="item-title">{{shortName}}</div>'+
                              '</div>'+
                              '<div class="item-subtitle">{{name}}</div>'+
                              '<div class="item-text">{{shortIntro}}</div>'+
                            '</div>'+
                          '</a>'+
                        '</li>';
              var itemHTMLs = [];
              items.forEach(function (item, index, items) {
                var itemHTML = itemTpl.replace(/{{img}}/,item.img_url)
                                      .replace(/{{shortName}}/,item.short_name)
                                      .replace(/{{name}}/,item.name)
                                      .replace(/{{shortIntro}}/,item.short_intro);
                itemHTMLs.push(itemHTML);
              });
              $(selector).append(itemHTMLs.join(''));
            }

            function addItems(selector,items) {
              var itemTpl = '<li>'+
                          '<a href="#" class="item-link item-content">'+
                            '<div class="item-media"><img src="{{img}}"></div>'+
                            '<div class="item-inner">'+
                              '<div class="item-title-row">'+
                                '<div class="item-title">{{shortName}}</div>'+
                              '</div>'+
                              '<div class="item-subtitle">{{name}}</div>'+
                              '<div class="item-text">{{shortIntro}}</div>'+
                            '</div>'+
                          '</a>'+
                        '</li>';
              var itemHTMLs = [];
              items.forEach(function (item, index, items) {
                var itemHTML = itemTpl.replace(/{{img}}/,item.img_url)
                                      .replace(/{{shortName}}/,item.short_name)
                                      .replace(/{{name}}/,item.name)
                                      .replace(/{{shortIntro}}/,item.short_intro);
                itemHTMLs.push(itemHTML);
              });
              $(selector).append(itemHTMLs.join(''));
            }

            function getData(callback) {
              setTimeout(function(){
                $.ajax({
                  url:'http://mock',
                  type:'get',
                  success:function(data){
                    var list = $.parseJSON(data).list;
                    console.log(list);
                    callback(list);
                  }
                });
              },1000);
            }

            $(document).on("pageInit",function(e, id, page) {
              getData(function(data){
                addItems('.media-list ul',data);
              });
              var loading = false;
              var begin = 2;
              $(page).on('infinite', function() {
                // 如果正在加载，则退出
                if (loading) return;
                // 设置flag
                loading = true;
                loading = false;
                getData(function(data){
                  // 加载完毕，则注销无限加载事件，以防不必要的加载
                  // $.detachInfiniteScroll($('.infinite-scroll'));
                  // 删除加载提示符
                  // $('.infinite-scroll-preloader').remove();
                  addItems('.media-list ul',data);
                  // $.refreshScroller();
                });

              });
            });

            $.init();
        })();

    </script>
  </body>
</html>
